--Se eliminan y recrean las tablas destino de los KPI
DROP TABLE "KPI_1";
DROP TABLE "KPI_2";
DROP TABLE "KPI_3";
DROP TABLE "KPI_4";
DROP TABLE "KPI_5";
DROP TABLE "KPI_6";
DROP TABLE "KPI_7";

--tabla KPI_1 para conteo de registros por año
CREATE TABLE "KPI_1" (
    "KPI_1_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    "ANIO" VARCHAR2(20) NOT NULL,
    "TOTAL_REGISTROS" NUMBER,

    CONSTRAINT "KPI_1_PK" PRIMARY KEY ("KPI_1_ID"),
    CONSTRAINT "UNIQUE_ANIO" UNIQUE ("ANIO")
);
-- tabla KPI_2 para análisis de ventas

CREATE TABLE "KPI_2" (
    "KPI_2_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "PERIODO" VARCHAR2(15) NOT NULL,
    "TOTAL_NETO" NUMBER(16,2),
    "VARIACION_PORCENTAJE" NUMBER(10,2),
    "FECHA_ACTUALIZACION" DATE NOT NULL,

    CONSTRAINT "UNIQUE_PERIODO_KPI2" UNIQUE ("PERIODO")
);
-- Crear tabla KPI_3 para valores estadísticos de compras

CREATE TABLE "KPI_3" (
    "KPI_3_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "PERIODO" VARCHAR2(15) NOT NULL,
    "PROMEDIO_COMPRA" NUMBER(16,2),
    "MEDIANA_COMPRA" NUMBER(16,2),
    "VALOR_MODAL" NUMBER(16,2),
    "CANTIDAD_COMPRAS" NUMBER,
    "VARIACION_PROMEDIO" NUMBER(10,2),
    "FECHA_ACTUALIZACION" DATE NOT NULL,
    
    CONSTRAINT "UNIQUE_PERIODO_KPI3" UNIQUE ("PERIODO")
);

-- Crear tabla KPI_4 para stock por categoría
CREATE TABLE "KPI_4" (
    "KPI_4_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "FRANQUICIA" VARCHAR2(50) NOT NULL,
    "STOCK_AGREGADO_ACTUAL" NUMBER NOT NULL,
    "VARIACION_PORCENTAJE" NUMBER(10,2),
    "ESTADO_STOCK" VARCHAR2(20),
    "PRODUCTOS_BAJO_STOCK" NUMBER,
    "TOTAL_PRODUCTOS" NUMBER,
    "FECHA_ACTUALIZACION" DATE NOT NULL,

    CONSTRAINT "UNIQUE_FRANQUICIA_KPI4" UNIQUE ("FRANQUICIA")
);

-- Crear tabla KPI_5 para tasa de entregas exitosas

CREATE TABLE "KPI_5" (
    "KPI_5_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "PERIODO" VARCHAR2(15) NOT NULL,
    "TASA_EXITOSAS" NUMBER(5,2) NOT NULL,
    "VARIACION_TASA" NUMBER(5,2),
    "FECHA_ACTUALIZACION" DATE NOT NULL,
    
    CONSTRAINT "UNIQUE_PERIODO_KPI5" UNIQUE ("PERIODO")
);

-- Crear tabla KPI_6 para clientes recurrentes
CREATE TABLE "KPI_6" (
    "KPI_6_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "ANIO" VARCHAR2(4) NOT NULL,
    "TOTAL_CLIENTES_UNQ" NUMBER NOT NULL,
    "TASA_RECURRENCIA" NUMBER(5,2) NOT NULL,
    "VARIACION_TASA" NUMBER(5,2),
    "FECHA_ACTUALIZACION" DATE NOT NULL,

    CONSTRAINT "UNIQUE_ANIO_KPI6" UNIQUE ("ANIO")
);

-- Crear tabla KPI_7 para tasa de conversión de carritos

CREATE TABLE "KPI_7" (
    "KPI_7_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "PERIODO" VARCHAR2(15) NOT NULL,
    "TOTAL_CARRITOS" NUMBER NOT NULL,
    "TASA_CONVERSION" NUMBER(5,2) NOT NULL,
    "VARIACION_TASA" NUMBER(5,2),
    "FECHA_ACTUALIZACION" DATE NOT NULL,
    
    CONSTRAINT "UNIQUE_PERIODO_KPI7" UNIQUE ("PERIODO")
);
